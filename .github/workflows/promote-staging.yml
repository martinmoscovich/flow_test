name: Promote to Staging

on: 
  workflow_dispatch:
    inputs:
      release-version:
        description: 'Release version tag'
        required: true

env:
  DIST_DIR: build
  DEPLOYMENT_PATH: staging

jobs:
  # build:
  #   name: Build
  #   runs-on: ubuntu-latest

  #   steps:
  #     - name: Build
  #       uses: martinmoscovich/gh-actions/npm-build@1
  #       with:
  #         node_version: 14
  #         dist_dir: ${{ env.DIST_DIR }}

  promote:
    name: Promote
    # needs: build
    runs-on: ubuntu-latest
    # if: startsWith(github.ref, 'refs/tags/v')

    steps:
      - name: Download release
        uses: dsaltares/fetch-gh-release-asset@master
        with:
          version: "tags/${{ github.event.inputs.release-version }}"
          file: "${{ github.event.repository.name }}-${{ github.event.inputs.release-version }}.zip"
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Unzip release
        uses: montudor/action-zip@v1
        with:
          args: unzip -qq ${{ github.event.repository.name }}-${{ github.event.inputs.release-version }}.zip -d ${{ env.DIST_DIR }}

      - name: Deploy to gh-pages
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./${{ env.DIST_DIR }}
          destination_dir: ./${{ env.DEPLOYMENT_PATH }}
